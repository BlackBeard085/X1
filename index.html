const rpcUrl = "https://rpc.testnet.x1.xyz";

async function fetchEpochData() {
    try {
        // Fetch the current epoch
        const response = await fetch(`${rpcUrl}/`);
        const apiData = await response.json();
        
        const currentEpochEndpoint = apiData.endpoints.epoch;
        
        const responseEpoch = await fetch(currentEpochEndpoint);
        const epochData = await responseEpoch.json();
        
        document.getElementById('current-epoch').innerText = epochData.epoch;
        
        const validatorNameEndpoint = apiData.endpoints.validator_info;
        const responseValidatorName = await fetch(validatorNameEndpoint);
        const validatorNameData = await responseValidatorName.json();
        
        const yourIdentity = "HNezNfYC8YyzZBADNaJ7ZuLseqFWmMsFqriGuccZ9kCT";
        const validatorName = validatorNameData.find(val => val.identity === yourIdentity).name;
        
        document.getElementById('validator-name').innerText = validatorName;
        
        const stakeInfoEndpoint = apiData.endpoints.stake;
        
        const responseStakeInfo = await fetch(stakeInfoEndpoint);
        const stakeInfoData = await responseStakeInfo.json();
        
        document.getElementById('total-staked').innerText = stakeInfoData.total_staked;
        document.getElementById('active-stake').innerText = stakeInfoData.active_stake;
        document.getElementById('delinquent-stake').innerText = stakeInfoData.delinquent_stake;
        
        const leaderScheduleEndpoint = apiData.endpoints.leader_schedule;
        const responseLeaderSchedule = await fetch(leaderScheduleEndpoint);
        const leaderScheduleData = await responseLeaderSchedule.json();
        
        const yourNextLeader = leaderScheduleData.find(leader => leader.identity === yourIdentity);
        
        document.getElementById('next-leader').innerText = yourNextLeader ? yourNextLeader.slot.toString() : "Not scheduled";
    } catch (error) {
        console.error('Error fetching data:', error);
    }
}
